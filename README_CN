# Anthropic to OpenAI API ä»£ç†æœåŠ¡å™¨

[![English](https://img.shields.io/badge/lang-English-blue.svg)](README.md) [![ä¸­æ–‡](https://img.shields.io/badge/lang-ä¸­æ–‡-red.svg)](README_CN.md)

ä¸€ä¸ªè½»é‡çº§çš„Pythonä»£ç†æœåŠ¡å™¨ï¼Œå°†Anthropic Messages APIæ ¼å¼çš„è¯·æ±‚è½¬æ¢ä¸ºOpenAI Chat Completions APIæ ¼å¼ï¼Œå¹¶è½¬å‘åˆ°æœ¬åœ°OpenAIé£æ ¼çš„æœåŠ¡ã€‚

## âœ¨ ç‰¹æ€§

### ğŸŸ¢ æ”¯æŒçš„åŠŸèƒ½
- `POST /v1/messages` - Anthropic Messages APIç«¯ç‚¹
- æ–‡æœ¬å¯¹è¯ï¼ˆ`type: text`ï¼‰
- å•è½®/å¤šè½®å¯¹è¯
- Systemæç¤ºè¯
- æµå¼å“åº”ï¼ˆstream=true/falseï¼‰
- åŸºæœ¬å‚æ•°ï¼ˆmodel, temperature, top_p, max_tokensï¼‰
- Contentæ•°ç»„æ ¼å¼ï¼ˆå¤šä¸ªtextå—æ‹¼æ¥ï¼‰
- å›½é™…åŒ–æ”¯æŒï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- é”™è¯¯å¤„ç†å’Œå‚æ•°éªŒè¯
- æ— å¤–éƒ¨ä¾èµ–ï¼Œä»…ä½¿ç”¨PythonåŸç”Ÿæ¨¡å—

### ğŸ”´ ä¸æ”¯æŒçš„åŠŸèƒ½
- Tools/function calling
- å›¾ç‰‡/æ–‡ä»¶/éŸ³é¢‘
- å¤šæ¨¡æ€å†…å®¹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.6 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ— éœ€é¢å¤–å®‰è£…åŒ…ï¼ˆä»…ä½¿ç”¨Pythonæ ‡å‡†åº“ï¼‰

### å®‰è£…å’Œè¿è¡Œ

1. **ä¸‹è½½ä»£ç **
   ```bash
   git clone https://github.com/yourusername/anthropic-openai-proxy.git
   cd anthropic-openai-proxy
   ```

2. **è¿è¡Œä»£ç†æœåŠ¡å™¨**
   ```bash
   python3 proxy_server_i18n.py
   ```

   æœåŠ¡å™¨å°†åœ¨ `http://localhost:8082` å¯åŠ¨

3. **é…ç½®åç«¯æœåŠ¡**

   é»˜è®¤é…ç½®ä¸ºï¼š
   - OpenAIåç«¯åœ°å€ï¼š`http://10.108.201.163:1025`
   - ç«¯ç‚¹ï¼š`/v1/chat/completions`

   å¦‚éœ€ä¿®æ”¹ï¼Œç¼–è¾‘ `proxy_server_i18n.py` ä¸­çš„ `Config` ç±»ã€‚

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨curl

#### éæµå¼è¯·æ±‚
```bash
curl -X POST http://localhost:8082/v1/messages \
  -H "Content-Type: application/json" \
  -H "anthropic-version: 2023-06-01" \
  -d '{
    "model": "DeepSeek32B",
    "max_tokens": 1024,
    "messages": [
      {"role": "user", "content": "ä½ å¥½ï¼"}
    ]
  }'
```

#### æµå¼è¯·æ±‚
```bash
curl -X POST http://localhost:8082/v1/messages \
  -H "Content-Type: application/json" \
  -H "Accept: text/event-stream" \
  -d '{
    "model": "DeepSeek32B",
    "max_tokens": 100,
    "messages": [
      {"role": "user", "content": "ä»‹ç»ä¸€ä¸‹æ˜¥å¤©"}
    ],
    "stream": true
  }' --no-buffer
```

#### å¸¦ç³»ç»Ÿæç¤ºçš„è¯·æ±‚
```bash
curl -X POST http://localhost:8082/v1/messages \
  -H "Content-Type: application/json" \
  -d '{
    "model": "DeepSeek32B",
    "system": "ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„åŠ©æ‰‹ï¼Œæ€»æ˜¯ç”¨ä¸­æ–‡å›ç­”ã€‚",
    "max_tokens": 100,
    "messages": [
      {"role": "user", "content": "Hello, how are you?"}
    ]
  }'
```

### ä½¿ç”¨Python

```python
import anthropic

# åˆ›å»ºå®¢æˆ·ç«¯ï¼ŒæŒ‡å‘ä»£ç†æœåŠ¡å™¨
client = anthropic.Anthropic(
    base_url="http://localhost:8082",
    api_key="dummy-key"  # ä»£ç†æœåŠ¡å™¨ä¸éªŒè¯APIå¯†é’¥
)

# å‘é€è¯·æ±‚
message = client.messages.create(
    model="DeepSeek32B",
    max_tokens=1024,
    messages=[
        {"role": "user", "content": "ä»‹ç»ä¸€ä¸‹Python"}
    ]
)

print(message.content[0].text)
```

### ä½¿ç”¨Node.js

```javascript
import Anthropic from '@anthropic-ai/sdk';

const anthropic = new Anthropic({
    baseURL: 'http://localhost:8082',
    apiKey: 'dummy-key', // ä»£ç†æœåŠ¡å™¨ä¸éªŒè¯APIå¯†é’¥
});

const message = await anthropic.messages.create({
    model: 'DeepSeek32B',
    max_tokens: 1024,
    messages: [
        { role: 'user', content: 'ä»‹ç»ä¸€ä¸‹JavaScript' }
    ]
});

console.log(message.content[0].text);
```

## ğŸ”„ è¯·æ±‚/å“åº”è½¬æ¢

### Anthropicè¯·æ±‚ â†’ OpenAIè¯·æ±‚

```json
// Anthropicæ ¼å¼
{
  "model": "DeepSeek32B",
  "system": "You are a helpful assistant",
  "max_tokens": 100,
  "temperature": 0.7,
  "messages": [
    {
      "role": "user",
      "content": [
        {"type": "text", "text": "Hello"},
        {"type": "text", "text": " world!"}
      ]
    }
  ]
}

// è½¬æ¢ä¸ºOpenAIæ ¼å¼
{
  "model": "DeepSeek32B",
  "messages": [
    {"role": "system", "content": "You are a helpful assistant"},
    {"role": "user", "content": "Hello world!"}
  ],
  "max_tokens": 100,
  "temperature": 0.7,
  "stream": false
}
```

### OpenAIå“åº” â†’ Anthropicå“åº”

```json
// OpenAIæ ¼å¼
{
  "choices": [
    {
      "message": {
        "content": "Hello! How can I help you?",
        "role": "assistant"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 10,
    "completion_tokens": 8
  }
}

// è½¬æ¢ä¸ºAnthropicæ ¼å¼
{
  "id": "msg_01XFDUDYJgAACzvnptvVoYEL",
  "type": "message",
  "role": "assistant",
  "model": "DeepSeek32B",
  "content": [
    {
      "type": "text",
      "text": "Hello! How can I help you?"
    }
  ],
  "stop_reason": "end_turn",
  "stop_sequence": null,
  "usage": {
    "input_tokens": 10,
    "output_tokens": 8
  }
}
```

## ğŸŒ å›½é™…åŒ–

ä»£ç†æœåŠ¡å™¨æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ä¸¤ç§è¯­è¨€ï¼š

- è‡ªåŠ¨æ£€æµ‹å®¢æˆ·ç«¯è¯­è¨€ï¼ˆåŸºäºUser-Agentï¼‰
- æœåŠ¡å™¨å¯åŠ¨ä¿¡æ¯ä½¿ç”¨æ£€æµ‹åˆ°çš„è¯­è¨€æ˜¾ç¤º
- æ—¥å¿—æ¶ˆæ¯æ”¯æŒåŒè¯­

## ğŸ“ é…ç½®è¯´æ˜

åœ¨ `Config` ç±»ä¸­å¯ä»¥é…ç½®ä»¥ä¸‹å‚æ•°ï¼š

```python
class Config:
    # OpenAIåç«¯æœåŠ¡åœ°å€
    OPENAI_BASE_URL = "http://10.108.201.163:1025"
    OPENAI_CHAT_ENDPOINT = "/v1/chat/completions"

    # ä»£ç†æœåŠ¡å™¨é…ç½®
    HOST = "0.0.0.0"  # ç›‘å¬åœ°å€
    PORT = 8082       # ç›‘å¬ç«¯å£
```

## â— é”™è¯¯å¤„ç†

ä»£ç†æœåŠ¡å™¨è¿”å›æ ‡å‡†çš„Anthropicé”™è¯¯æ ¼å¼ï¼š

```json
{
  "error": {
    "type": "invalid_request_error",
    "message": "messages field is required"
  }
}
```

å¸¸è§é”™è¯¯ç±»å‹ï¼š
- `invalid_request_error` - è¯·æ±‚æ ¼å¼é”™è¯¯
- `feature_not_supported` - ä¸æ”¯æŒçš„åŠŸèƒ½
- `api_error` - ä¸Šæ¸¸æœåŠ¡é”™è¯¯

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šè¿æ¥è¢«æ‹’ç»
- ç¡®ä¿ä»£ç†æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ç«¯å£8082æ˜¯å¦è¢«å ç”¨

### é—®é¢˜ï¼šä¸Šæ¸¸æœåŠ¡é”™è¯¯
- æ£€æŸ¥OpenAIé£æ ¼æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- éªŒè¯ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹`/tmp/local_anthropic.log`æ—¥å¿—æ–‡ä»¶

### é—®é¢˜ï¼šè¯·æ±‚æ ¼å¼é”™è¯¯
- ç¡®ä¿å‘é€çš„è¯·æ±‚ç¬¦åˆAnthropic Messages APIè§„èŒƒ
- éªŒè¯JSONæ ¼å¼æ˜¯å¦æ­£ç¡®

## ğŸ“‹ å¼€å‘è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤šOpenAIå‚æ•°ï¼ˆå¦‚presence_penalty, frequency_penaltyï¼‰
- [ ] æ·»åŠ è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
- [ ] æ”¯æŒè®¤è¯å’ŒAPIå¯†é’¥éªŒè¯
- [ ] æ·»åŠ è¯·æ±‚é€Ÿç‡é™åˆ¶
- [ ] æ”¯æŒWebSocketè¿æ¥

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢Anthropicå’ŒOpenAIæä¾›çš„ä¼˜ç§€API
- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„æ”¯æŒ

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æäº¤Issueï¼šhttps://github.com/yourusername/anthropic-openai-proxy/issues
- å‘é€é‚®ä»¶ï¼šyour.email@example.com
